#!/usr/bin/env bash
# Wrapper para brainx-v3 que usa la OPENAI_API_KEY de OpenClaw
# Ubicación: /home/clawd/repos/brainx-v3/brainx

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
OPENCLAW_CONFIG="$HOME/.openclaw/openclaw.json"

# Extraer OPENAI_API_KEY de openclaw.json
if [[ -f "$OPENCLAW_CONFIG" ]]; then
    API_KEY=$(grep -o '"OPENAI_API_KEY"[[:space:]]*:[[:space:]]*"[^"]*"' "$OPENCLAW_CONFIG" | sed 's/.*"OPENAI_API_KEY"[[:space:]]*:[[:space:]]*"\([^"]*\)"/\1/')
    
    if [[ -n "$API_KEY" ]]; then
        export OPENAI_API_KEY="$API_KEY"
    else
        echo "Error: No se encontró OPENAI_API_KEY en $OPENCLAW_CONFIG" >&2
        exit 1
    fi
else
    echo "Error: No se encontró $OPENCLAW_CONFIG" >&2
    exit 1
fi

# Ejecutar brainx-v3 original con los argumentos dados
exec "$SCRIPT_DIR/brainx-v3" "$@"

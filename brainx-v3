#!/usr/bin/env bash
set -euo pipefail

SOURCE_PATH="$0"
if command -v readlink >/dev/null 2>&1; then
  SOURCE_PATH="$(readlink -f "$0" 2>/dev/null || echo "$0")"
fi
ROOT="$(cd "$(dirname "$SOURCE_PATH")" && pwd)"

# Keep CLI output clean (dotenv@17 prints tips unless quiet)
export DOTENV_CONFIG_QUIET="${DOTENV_CONFIG_QUIET:-true}"

CMD="${1:-}"
shift || true

case "$CMD" in
  health)
    node "$ROOT/tests/smoke.js"
    ;;
  add|search|inject)
    node "$ROOT/lib/cli.js" "$CMD" "$@"
    ;;
  *)
    node "$ROOT/lib/cli.js" --help
    exit 1
    ;;
esac
